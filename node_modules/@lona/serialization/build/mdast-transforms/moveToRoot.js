"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const unist_util_flatmap_1 = __importDefault(require("unist-util-flatmap"));
function moveToRoot(targetType) {
    return (ast) => {
        return unist_util_flatmap_1.default(ast, (node) => {
            if (node.type === 'root')
                return [node];
            if (!node.children || !Array.isArray(node.children))
                return [node];
            if (node.children.every(child => child.type !== targetType))
                return [node];
            const out = [];
            let latestContiguous = Object.assign({}, node, { children: [] });
            for (let child of node.children) {
                if (child.type !== targetType) {
                    latestContiguous.children.push(child);
                }
                else {
                    if (latestContiguous.children.length > 0) {
                        out.push(latestContiguous);
                    }
                    out.push(child);
                    latestContiguous = Object.assign({}, node, { children: [] });
                }
            }
            if (latestContiguous.children.length > 0) {
                out.push(latestContiguous);
            }
            return out;
        });
    };
}
exports.default = moveToRoot;
